# SimpleHomeBroker
### Внешний брокер команд
![GitHub last commit](https://img.shields.io/github/last-commit/sershocode/simplehomebroker)
![Lines of code](https://img.shields.io/tokei/lines/github/sershocode/simplehomebroker?color=brigtgeen&label=Lines%20of%20code)
![.NET](https://github.com/SershoCode/SimpleHomeBroker/workflows/.NET/badge.svg?branch=main)

Брокер, принимающий запросы из различных входящих источников на контроллеры или специфичную входящую точку, обработав которые отправляет команды на конечные точки.

#### На данный момент сделаны следущие входящие источники:
- **Яндекс.Станция**
- **Telegram бот**  

#### И управляемые устройства (endpoint'ы):
- **Домашний ПК (клиент находится в репозитории [SimplePcControl](https://github.com/SershoCode/SimplePcControl))**
  - Управление мониторами
  - Выключение
  - Перезагрузка
  - Блокировка
  - Логаут

### For example
К примеру, сказав Я.Станции "Алиса, выключи мониторы", на контроллер примется запрос от Я.Диалога (посредник между колонкой и контроллером), сервис его обработает и вызовет нужную команду через медиатор. И по итогу вернет ответ на Я.Станцию, который произнесет Алиса.  
Так же, например, если написать telegram боту команду "Выключить мониторы" (на данный момент реализовано через relply-клавиатуру, чтобы не писать каждый раз вручную), то контроллер примет сообщение, вызовет ту же самую команду и вернет ответ специфичный конкретно для телеграма.  
Обобщив, основная концепция получается в том, что мы можем использовать неограниченное количество входящих источников, которые будут через свой сервис-обработчик вызывать через медиатор заранее созданные команды.  
Тестовая схема будет выглядеть примерно так:  
Источник > контроллер (либо специально написанный клиент для специфичных источников) > обрабочик > медиатор > конечная точка > ответ.  

Можно использовать простую обработку команд, без endpoint'a. Т.е пишем команду которая обрабатывает запрос и минуя какие-либо конечные точки отправляем обратно ответ.  

Схематично (вместе с устаревшим пайплайном) это выглядит так: [PNG диаграмма](https://github.com/SershoCode/SimpleHomeBroker/blob/main/SimpleHomeBrokerDiagram.png?raw=true)

Было принято решение перейти на более удобную и простую связку в виде GitHub Actions и наиболее дешевого VPS сервера. 
Все чувствительные данные (appsettings.json) ранее брались из HashiCorp Vault в момент работы пайплайна.
Сам устаревший пайплайн лежит в deprecated папке репозитория.

#### P.S
Кода мало, оставил его "как есть" без дикой шлифовки. Линтеры ругались на некоторые вещи, но я исправил только те, которые были упущены из-за невнимательности или "пропущены по запаре", при этом оставив моменты, которые без линтера я бы не увидел. Чтобы показать исключительно реальное положение вещей. 
